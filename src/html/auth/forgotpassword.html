<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Forgot Password - TaskHive</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link
			rel="shortcut icon"
			href="../../../images/taskhivelogo.svg"
			type="image/x-icon"
		/>
</head>
<body class="min-h-screen bg-gray-100 flex items-center justify-center overflow-hidden">
    <!-- Background Illustration -->
    <div class="absolute inset-0 pointer-events-none flex items-center justify-center">
        <div class="relative">
            <img src="../../../Assets/background-image.svg" alt="background-image">
        </div>
    </div>

    <!-- Main Content -->
    <div class="relative z-10 w-full max-w-md">
        <!-- Form Card -->
        <div class="bg-white rounded-2xl shadow-lg p-8 md:p-10">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-3xl md:text-3xl font-bold text-dark mb-7">Forgot Password?</h1>
                <p class="text-gray-600 text-sm md:text-base leading-relaxed">
                    Please enter your email address in the below box and we will send an email with a code.
                </p>
            </div>

            <!-- Form -->
            <form id="forgotPasswordForm" class="space-y-6">
                <!-- Email Field -->
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700 mb-2">
                        Email
                    </label>
                    <div class="relative">
                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                            <img src="../../../Assets/email-icon.svg" alt="email-icon">
                        </div>
                        <input 
                            type="email" 
                            id="email" 
                            name="email"
                            class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200 text-gray-900 placeholder-gray-500"
                            placeholder="Enter Email Address"
                            required>
                    </div>
                    <div id="emailError" class="mt-1 text-sm text-red-600 hidden"></div>
                </div>

                <!-- Submit Button -->
                <button 
                    type="submit" 
                    id="submitBtn"
                    class="w-full bg-blue-600 hover:bg-blue-500 text-white font-medium py-3 px-4 rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                >
                    <span id="buttonText">Verify Email</span>
                    <i id="loadingSpinner" class="fas fa-spinner fa-spin ml-2 hidden"></i>
                </button>
            </form>

            <!-- Success Message -->
            <div id="successMessage" class="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg hidden">
                <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                    <p class="text-green-700 text-sm">
                        Verification code sent successfully! Please check your email.
                    </p>
                </div>
            </div>
        </div>
    </div>




    <script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('forgotPasswordForm');
    const emailInput = document.getElementById('email');
    const emailError = document.getElementById('emailError');
    const submitBtn = document.getElementById('submitBtn');
    const buttonText = document.getElementById('buttonText');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const successMessage = document.getElementById('successMessage');

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    function validateEmail() {
      const email = emailInput.value.trim();
      if (email === '') {
        showError('Email address is required');
        return false;
      } else if (!emailRegex.test(email)) {
        showError('Please enter a valid email address');
        return false;
      } else {
        hideError();
        return true;
      }
    }

    function showError(message) {
      emailError.textContent = message;
      emailError.classList.remove('hidden');
      emailInput.classList.add('border-red-500', 'focus:ring-red-500', 'focus:border-red-500');
      emailInput.classList.remove('border-gray-300', 'focus:ring-blue-500', 'focus:border-blue-500');
    }

    function hideError() {
      emailError.classList.add('hidden');
      emailInput.classList.remove('border-red-500', 'focus:ring-red-500', 'focus:border-red-500');
      emailInput.classList.add('border-gray-300', 'focus:ring-blue-500', 'focus:border-blue-500');
    }

    function showLoadingState() {
      submitBtn.disabled = true;
      buttonText.textContent = 'Sending...';
      loadingSpinner.classList.remove('hidden');
    }

    function hideLoadingState() {
      submitBtn.disabled = false;
      buttonText.textContent = 'Verify Email';
      loadingSpinner.classList.add('hidden');
    }

    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      if (!validateEmail()) return;

      showLoadingState();
      successMessage.classList.add('hidden');

      try {
        const res = await fetch('https://be.taskmanager.kode.camp/auth/forgot-password', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify({ email: emailInput.value.trim() })
        });

        const data = await res.json();


// connecting the verification code flow (so the token/code from “forgot password” is passed into reset password API)

        if (res.ok && data.message) {
  // Show success message
  successMessage.querySelector('p').textContent = data.message;
  successMessage.classList.remove('hidden');

  // ✅ Store token/code if backend returns it
  if (data.token) {
    localStorage.setItem('resetToken', data.token);
  }

  // ✅ Redirect to reset password page
  setTimeout(() => {
    window.location.href = 'newpassword.html';
  }, 2000);
}


// Without the verification code flow

        // if (res.ok && data.message) {
        //   // Show success message
        //   successMessage.querySelector('p').textContent = data.message;
        //   successMessage.classList.remove('hidden');

        //   // ✅ Redirect to reset password page
        //   setTimeout(() => {
        //     window.location.href = 'newpassword.html';
        //   }, 2000);




          
        // } 
        

        else {
          alert(data.message || 'Failed to send reset email. Try again.');
        }
      } catch (error) {
        console.error('Forgot password error:', error);
        alert('Network error. Please try again.');
      } finally {
        hideLoadingState();
      }
    });

    // Add focus effects
    emailInput.addEventListener('focus', function() {
      this.parentElement.classList.add('ring-2', 'ring-blue-500', 'ring-opacity-20');
    });
    emailInput.addEventListener('blur', function() {
      this.parentElement.classList.remove('ring-2', 'ring-blue-500', 'ring-opacity-20');
    });
  });
</script>

</body>
</html>